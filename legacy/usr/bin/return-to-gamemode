#!/bin/bash

USER=$(id -nu 1000)
HOME=$(getent passwd $USER | cut -d: -f6)

# SteamOS autologin config
AUTOLOGIN_CONF='/etc/lightdm/lightdm.conf.d/10-gamescope-session.conf'

# Configure autologin if Steam has been updated
if [[ -f $HOME/.local/share/Steam/ubuntu12_32/steamui.so ]]; then
  {
    echo "[Seat:*]"
    echo "autologin-session=gamescope-session"
  } | sudo tee "$AUTOLOGIN_CONF"
fi

sudo -Eu $USER gnome-session-quit --logout --no-prompt
sudo -Eu $USER systemctl reset-failed lightdm
sudo -Eu $USER systemctl restart lightdm
